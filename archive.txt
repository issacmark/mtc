#!/bin/bash

# Your private token to authenticate with the GitLab API
PRIVATE_TOKEN="your_private_token"

# Base URL for your GitLab instance
GITLAB_URL="https://gitlab.example.com"

# Project name and group in the format "group/project"
PROJECT_FULL_PATH="ces/terraform-aws-acm"

# URL encode the project full path
ENCODED_PROJECT_NAME=$(echo $PROJECT_FULL_PATH | jq -sRr @uri)

# Make API call to get the project ID
PROJECT_ID=$(curl --header "PRIVATE-TOKEN: $PRIVATE_TOKEN" "$GITLAB_URL/api/v4/projects/$ENCODED_PROJECT_NAME" | jq '.id')

if [ "$PROJECT_ID" != "null" ]; then
  echo "Archiving project ID $PROJECT_ID"
  # Archive the project
  curl --request POST --header "PRIVATE-TOKEN: $PRIVATE_TOKEN" "$GITLAB_URL/api/v4/projects/$PROJECT_ID/archive"
else
  echo "Project $PROJECT_FULL_PATH not found"
fi